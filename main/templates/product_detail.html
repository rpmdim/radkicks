{% extends 'base.html' %}
{% load static %}

{% block meta %}

<title>{{ item.name }} - Football Store</title>
{% endblock meta %}

{% block content %}
<button
  onclick="showToast('Sample Title', 'This is a sample message for the toast notification.')"
>
  Click to Show Toast
</button>
<div class="bg-gray-900 w-full min-h-screen">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

<!-- Back Navigation -->
<div class="mb-6">
  <a href="{% url 'main:show_main' %}" class="text-red-400 hover:text-white font-medium transition-colors">
    ← Back to Catalog
  </a>
</div>

<!-- Loading State (visible while AJAX loads) -->
<div id="loading-state" class="bg-red-700 rounded-lg border border-red-700 p-12 text-center">
  <svg class="animate-spin h-8 w-8 text-yellow-300 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
  </svg>
  <p class="text-yellow-200 mt-3">Loading product detail...</p>
</div>

<!-- Error State -->
<div id="error-state" class="hidden bg-red-800 rounded-lg border border-red-700 p-12 text-center">
  <div class="w-16 h-16 mx-auto mb-4">
    <div class="text-yellow-300 text-4xl">⚠️</div>
  </div>
  <h3 class="text-lg font-medium text-white mb-2">Failed to load product</h3>
  <p class="text-gray-300">Please try again later.</p>
</div>

<!-- Product Content (populated via AJAX) -->
<article id="product-content" class="hidden bg-red-700 rounded-lg border border-red-700 overflow-hidden shadow-lg">
  <!-- Header -->
  <div class="p-6 sm:p-8">
    <div id="badges-container" class="flex flex-wrap items-center gap-2 mb-4">
      <!-- Dynamic badges inserted here -->
    </div>

    <h1 id="product-title" class="text-3xl sm:text-4xl font-bold text-white leading-tight mb-2">
      <!-- title -->
    </h1>

    <p id="product-brand" class="text-xl font-semibold text-gray-100 mb-4">
      <!-- brand -->
    </p>
  </div>

  <!-- Featured Image -->
  <div id="featured-image-container" class="px-6 sm:px-8 hidden">
    <img id="featured-image" src="" alt="" class="w-full h-auto max-h-[600px] object-contain rounded-lg bg-red-800 mx-auto">
  </div>

  <!-- Content -->
  <div class="p-6 sm:p-8">
    <!-- Price -->
    <p id="product-price" class="text-[#00FF80] font-bold text-2xl mb-4">
      <!-- price -->
    </p>

    <!-- Description -->
    <div id="product-description" class="text-gray-200 leading-relaxed whitespace-pre-line text-base sm:text-lg mb-6">
      <!-- description -->
    </div>

    <!-- Badges: Size, Stock, Rating -->
    <div class="flex flex-wrap gap-2 mb-6">
      <span id="product-size" class="hidden inline-flex items-center px-4 py-2 rounded-md text-base font-medium bg-gray-100 text-gray-800">
        Size: <span id="product-size-value"></span>
      </span>

      <span id="product-stock" class="inline-flex items-center px-4 py-2 rounded-md text-base font-medium bg-black/50 text-yellow-100">
        Stock: <span id="product-stock-value"></span>
      </span>

      <span id="product-rating" class="inline-flex items-center px-4 py-2 rounded-md text-base font-medium bg-yellow-100 text-yellow-800">
        ★ <span id="product-rating-value"></span>
      </span>
    </div>
  </div>

  <!-- Seller Info -->
  <div class="border-t border-red-700 p-6 sm:p-8 bg-red-800">
    <div class="flex items-center justify-between">
      <div>
        <div id="product-seller" class="font-medium text-white">Seller: Loading...</div>
        <p class="text-sm text-gray-300">Official Seller</p>
      </div>
    </div>
  </div>
</article>

  </div>
</div>

<!-- AJAX script to populate the placeholders -->
<script>
// Configuration
const PRODUCT_ID = "{{ item.id }}";
const PRODUCT_DETAIL_ENDPOINT = `{% url 'main:show_json_by_id' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', PRODUCT_ID);

// DOM Elements
const loadingState = document.getElementById('loading-state');
const errorState = document.getElementById('error-state');
const productContent = document.getElementById('product-content');
const badgesContainer = document.getElementById('badges-container');
const productTitle = document.getElementById('product-title');
const productBrand = document.getElementById('product-brand');
const featuredImageContainer = document.getElementById('featured-image-container');
const featuredImage = document.getElementById('featured-image');
const productPrice = document.getElementById('product-price');
const productDescription = document.getElementById('product-description');
const productSize = document.getElementById('product-size');
const productSizeValue = document.getElementById('product-size-value');
const productStockValue = document.getElementById('product-stock-value');
const productStock = document.getElementById('product-stock');
const productRatingValue = document.getElementById('product-rating-value');
const productRating = document.getElementById('product-rating');
const productSeller = document.getElementById('product-seller');

// Show/hide page sections
function showState(state) {
  loadingState.classList.toggle('hidden', state !== 'loading');
  errorState.classList.toggle('hidden', state !== 'error');
  productContent.classList.toggle('hidden', state !== 'ready');
}

// Helper to create badge
function createBadge(text, classes) {
  const el = document.createElement('span');
  el.className = classes;
  el.textContent = text;
  return el;
}

// Render product into placeholders
function renderProduct(p) {
  // Title and document title
  productTitle.textContent = p.name || 'Product';
  document.title = `${p.name || 'Product'} - RADKICKS`;

  // Brand
  productBrand.textContent = p.brand ? `Brand: ${p.brand}` : '';
  if (!p.brand) productBrand.classList.add('hidden');

  // Badges
  badgesContainer.innerHTML = '';
  if (p.category) {
    badgesContainer.appendChild(createBadge(p.category, 'inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-yellow-500 text-white'));
  }
  if (p.is_featured) {
    badgesContainer.appendChild(createBadge('Featured', 'inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-orange-100 text-orange-800'));
  }
  if (Number(p.stock) === 0) {
    badgesContainer.appendChild(createBadge('Out of Stock', 'inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-red-100 text-red-800'));
  }

  // Image
  if (p.thumbnail) {
    featuredImage.src = p.thumbnail;
    featuredImage.alt = p.name || 'Product image';
    featuredImageContainer.classList.remove('hidden');
  } else {
    featuredImageContainer.classList.add('hidden');
  }

  // Price
  productPrice.textContent = p.price ? `Rp ${p.price}` : '';

  // Description
  productDescription.textContent = p.description || '';

  // Size
  if (p.size) {
    productSizeValue.textContent = p.size;
    productSize.classList.remove('hidden');
  } else {
    productSize.classList.add('hidden');
  }

  // Stock
  productStockValue.textContent = p.stock || 0;

  // Rating
  productRatingValue.textContent = (p.rating !== undefined && p.rating !== null) ? Number(p.rating).toFixed(1) : '0.0';

  // Seller
  productSeller.textContent = p.user_username ? `Seller: ${p.user_username}` : 'Seller: A Football Head';
}

// Fetch product detail
async function loadProductDetail() {
  try {
    showState('loading');
    const res = await fetch(PRODUCT_DETAIL_ENDPOINT, { headers: { 'Accept': 'application/json' } });
    if (!res.ok) throw new Error('Network error');
    const data = await res.json();

    // If view returns array (serializer), pick first element
    const product = Array.isArray(data) ? (data[0] || {}) : data;

    renderProduct(product);
    showState('ready');
  } catch (err) {
    console.error('Error loading product detail:', err);
    showState('error');
  }
}

// Init
loadProductDetail();
</script>

{% endblock content %}